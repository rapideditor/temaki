<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Temaki Icons</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script id="icon-meta" type="application/json">{{icon_meta}}</script>
<link href='style.css' rel='stylesheet' type='text/css'/>
</head>

<body>
<svg width="0" height="0" style="position:absolute">
{{#shapes}}     {{{svg}}}
{{/shapes}}
</svg>

<section>
  <div id="header">
    <div class="line content">
      <h3><a href="https://github.com/rapideditor/temaki"><svg><use xlink:href="#temaki-temaki"></use></svg>Temaki Icons</a></h3>
      <input type="text" id="search" placeholder="Search icons"/>
    </div>
  </div>
  <div id="main" class="content">
    <ul id="groups"></ul>
    <ul id="icons">
{{#shapes}}<li id="icon-{{name}}" title="{{name}}">
      <a href="#icon-{{name}}">
      <div class="icon-box">
        <svg class="icon-lg"><use xlink:href="#{{name}}"></use></svg>
        <svg class="icon-sm"><use xlink:href="#{{name}}"></use></svg>
      </div>
      <div class="icon-name">{{name}}</div>
      </a>
    </li>{{/shapes}}
    </ul>
  </div>
  <footer>
    <p>Previews at 40x40 and 15x15. Generated by <a href="https://github.com/jkphl/svg-sprite" target="_blank">svg-sprite</a>.</p>
  </footer>
</section>
</body>

<script type="text/javascript">
  function htmlDecode(input){
    var e = document.createElement('div');
    e.innerHTML = input;
    return e.childNodes.length === 0 ? "" : e.childNodes[0].nodeValue;
  }

  function onLoad() {
    var metadata = JSON.parse(htmlDecode(document.getElementById('icon-meta').innerHTML));
    var groups = {};

    for (var name in metadata) {
      var iconInfo = metadata[name];
      var el = document.getElementById('icon-temaki-' + name);
      for (var i in iconInfo.groups) {
        var group = iconInfo.groups[i];

        if (!groups[group]) groups[group] = [];

        groups[group].push(name);

        el.classList.add('grp-' + group);
      }
    }

    var sortedGroups = Object.keys(groups).sort();

    for (var i in sortedGroups) {
      var group = sortedGroups[i];
      var groupEl = document.createElement('li');
      var a = groupEl.appendChild(document.createElement('a'));
      a.setAttribute('href', '#group=' + group);
      a.classList.add('group-' + group);
      a.innerHTML = group;
      a.addEventListener('click', function(e) {
        if (e.target.classList.contains('selected')) {
          e.preventDefault();
          location.hash = '';
        }
      });
      document.getElementById('groups').appendChild(groupEl);
    }

    function doSearch(e) {
      location.hash = '';
      var s = e && e.target && e.target.value.trim().toLowerCase().replace(/[^a-z0-9]/gi, '');
      for (var name in metadata) {
        var el = document.getElementById('icon-temaki-' + name);
        var flatName = s && name.trim().toLowerCase().replace(/[^a-z0-9]/gi, '');
        if (flatName && flatName.indexOf(s) === -1) {
          el.classList.add('hidden');
        } else {
          el.classList.remove('hidden');
        }
      }
    }
    document.getElementById('search').addEventListener('input', doSearch);

    function updateForHash() {
      document.querySelectorAll('#groups a.selected').forEach(function(el) {
        el.classList.remove('selected');
      });

      var hash = location.hash;
      if (hash) hash = hash.slice(1);
      if (hash.indexOf('group=') === 0) {
        document.getElementById('search').value = '';
        var group = hash.slice(6);

        document.querySelector('#groups .group-' + group).classList.add('selected');

        document.querySelectorAll('#icons li').forEach(function(el) {
          el.classList.add('hidden');
        });
        document.querySelectorAll('#icons .grp-' + group).forEach(function(el) {
          el.classList.remove('hidden');
        });
      } else {
        document.querySelectorAll('#icons li.hidden').forEach(function(el) {
          el.classList.remove('hidden');
        });
      }
    }


    window.addEventListener('hashchange', updateForHash);
    updateForHash();
  }

  window.addEventListener('load', onLoad);
</script>
</html>
